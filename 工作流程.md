## 工作流程

1. **数据准备**
   - 规范化并合并数据为单一csv文件。
   - 处理空缺值：根据特征的重要性和空缺值的比例，选择适当的方法处理空缺值，如均值填补、中位数填补或使用机器学习模型预测填补。

2. **特征选择和编码**
   - 初步特征选择：选择完整数据，使用RandomForestClassifier进行特征重要性分析，筛选出关键特征。
   - 对分类特征进行one-hot编码：将所有非数值型特征转化为适合模型训练的格式。

3. **模型训练和评估**
   - 模型选择：选择几个常用的分类模型，如决策树、随机森林、梯度提升等。
   - 模型训练：使用选定的模型进行训练，调整参数以获得最佳性能。
   - 模型评估：使用交叉验证方法评估模型的性能，选择最佳模型。

4. **模型提升和解释**
   - 模型提升：通过超参数调优和集成方法（如集成学习、Bagging、Boosting等）提高模型的准确性和鲁棒性。
   - 模型解释：使用SHAP值分析模型的决策过程，解释关键特征对预测结果的影响，识别出影响事故的主要因素。

## 步骤1：数据处理

### 问题
1. 在Python中读取和处理Excel数据速度缓慢：数据排版不一致，有些在第一页，有些在第二页。
2. 数据空缺：数据集中存在许多空缺值。

### 解决方法
1. **统一化**
   - 将数据合并并转换为单一的csv文件，方便后续拆分为训练集、测试集和验证集。

2. **特征筛选（初步）**
   - 尽量保留足够完整的特征。
   - 对于空缺超过70%的特征，如果没有明显的用途，可以先舍弃；如果有半监督学习或填补方法，可以在后续处理时再考虑使用这些数据。

### 数据保留
1. **地理特征**
   - 保留坐标和区域名称（转换为代码）。
   
2. **时间特征**
   - 昼夜、日、月、年、时间。
   
3. **人物特征**
   - 年龄、性别、国籍。
   
4. **现场特征**
   - 天气、光线、道路类型、速限、道路形态、事故位置、事故类型及形态。
   
5. **案件特征**
   - 处理别、案号、当事人序、车种。
   
6. **其他特征**
   - 死亡人数、2-30日死亡人数、受伤人数、路面状况1、路面状况2、路面状况3、道路障碍1、道路障碍2、号志1、号志2、车道划分-分向、车道划分-分道1、车道划分-分道2、车道划分-分道3、重大车损、受伤程度、主要伤处、行动电话、车辆用途、当事者行动状态、驾驶资格情形、驾驶执照种类、饮酒情形、主要车损、其他车损、肇逃否、职业、旅次目的。
   
7. **结果**
   - 肇因码-个别、肇因码-主要。

**注意**：数据大多以代码呈现，对照表见附图（对照表.jpg）。

## 步骤2：特征处理/选择

### 当前状态
- 已将所有数据转为csv格式，并保留大部分可以考虑使用的特征。

### 问题
1. 空缺值尚未处理。
2. 需要筛选出对结果有关键影响的特征。
3. 需要确定是否对每个特征进行后续分析/处理。

### 解决方法
1. **选择特定特征下完全没有空缺的数据（完整数据）**
   - 首先处理没有空缺的子集数据。
   
2. **特征重要性分析**
   - 使用RandomForestClassifier分析每个特征对分类结果的贡献。
   - 筛选出对结果有显著贡献的特征用于后续模型训练。
   
3. **编码非数值型特征**
   - 对所有非数值型特征进行one-hot编码，准备进行机器学习模型训练。

## 步骤3：模型测试

### 操作
1. **模型选择**
   - 选择合适的分类模型（如决策树、随机森林、梯度提升）。

2. **模型提升**
   - 使用超参数调优、交叉验证和集成方法提高事故预测准确率。

3. **解释性**
   - 利用SHAP（Shapley Additive Explanations）分析和解释导致事故上升的因素。

### 工作流程详解
1. **数据准备**
   - 将所有数据规范化，统一格式后合并为一个csv文件。
   - 处理空缺值：可以使用均值填补、中位数填补或者通过机器学习模型进行预测填补，具体选择方法依据特征的重要性和空缺值的比例决定。

2. **特征选择和编码**
   - 进行初步特征选择：选择那些没有空缺值的数据，使用RandomForestClassifier分析每个特征的重要性，从中筛选出关键特征。
   - 对非数值型特征进行one-hot编码：将所有分类特征转换为适合模型训练的格式，确保数据的一致性和模型的准确性。

3. **模型训练和评估**
   - 模型选择：选择常用的分类模型，如决策树、随机森林和梯度提升，进行初步模型训练。
   - 模型训练：使用训练数据集进行模型训练，并调整参数以优化模型性能。
   - 模型评估：采用交叉验证的方法评估模型性能，选择表现最佳的模型进行进一步优化。

4. **模型提升和解释**
   - 模型提升：通过超参数调优和集成方法（例如Bagging和Boosting）来提升模型的预测准确性和稳定性。
   - 模型解释：使用SHAP值分析模型的决策过程，解释每个特征对预测结果的影响，识别影响事故发生的主要因素，从而提升模型的可解释性。
